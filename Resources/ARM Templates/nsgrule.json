{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "nsgRules": {
            "type": "array",
            "defaultValue": [{
                "priority": 100,
                "name": "HTTP",
                "port": "80"
            }, {
                "priority": 200,
                "name": "HTTPS",
                "port": "443"
            }, {
                "priority": 300,
                "name": "RDP",
                "port": "3389"

            }]
        }
    },
    "variables": {
        "propertiesSecurityRules": [{
            "name": "[parameters('nsgRules')[0].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[0].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[0].priority]",
                "direction": "Inbound"
            }
        }, {
            "name": "[parameters('nsgRules')[1].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[1].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[1].priority]",
                "direction": "Inbound"
            }
        }, {
            "name": "[parameters('nsgRules')[2].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[2].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[2].priority]",
                "direction": "Inbound"
            }
        }, {
            "name": "[parameters('nsgRules')[3].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[3].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[3].priority]",
                "direction": "Inbound"
            }
        }, {
            "name": "[parameters('nsgRules')[4].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[4].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[4].priority]",
                "direction": "Inbound"
            }
        }, {
            "name": "[parameters('nsgRules')[5].name]",
            "properties": {
                "protocol": "TCP",
                "sourcePortRange": "*",
                "destinationPortRange": "[parameters('nsgRules')[5].port]",
                "sourceAddressPrefix": "*",
                "destinationAddressPrefix": "*",
                "access": "Allow",
                "priority": "[parameters('nsgRules')[5].priority]",
                "direction": "Inbound"
            }
        }]
    },
    "resources": [],
    "outputs": {
        "result": {
            "type": "array",
            "value": "[take(variables('propertiesSecurityRules'),length(parameters('nsgRules')))]"
        }
    }
}