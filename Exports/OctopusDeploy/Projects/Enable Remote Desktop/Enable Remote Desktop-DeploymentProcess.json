{
  "$type": "Octopus.Core.Model.Projects.DeploymentProcess, Octopus.Core",
  "Id": "deploymentprocess-Projects-2",
  "OwnerId": "Projects-2",
  "Version": 45,
  "Steps": [
    {
      "Id": "1f7eaedc-d772-4fde-8a11-c298cb6e6880",
      "Name": "Enable Octopus NSG Rule",
      "Condition": "Success",
      "StartTrigger": "StartAfterPrevious",
      "RequiresPackagesToBeAcquired": false,
      "Actions": [
        {
          "Id": "786699e4-133c-4d95-bc2c-11ada76887ff",
          "Name": "Enable Octopus NSG Rule",
          "ActionType": "Octopus.AzurePowerShell",
          "IsDisabled": false,
          "Environments": [],
          "Channels": [],
          "TenantTags": [],
          "Properties": {
            "Octopus.Action.Azure.AccountId": "azureserviceprincipal-microsoft-azure-service-principal",
            "Octopus.Action.Script.ScriptSource": "Inline",
            "Octopus.Action.Script.ScriptBody": "$nsg = Get-AzureRmNetworkSecurityGroup -Name $OctopusNSGName -ResourceGroupName $InfraRg\n\n$rdpRule = $nsg | % SecurityRules | ? { $_.Name -eq 'RDP' -and $_.Priority -eq 999 }\n$rdpRule.Access = 'Allow'\n\n$nsg | Set-AzureRmNetworkSecurityGroup\n"
          }
        }
      ],
      "Properties": {
        "Octopus.Action.TargetRoles": "Octopus Deploy Server"
      }
    },
    {
      "Id": "e046ef07-c3a0-4f2d-af29-1d5775b8f80e",
      "Name": "Enable TeamCity NSG Rule",
      "Condition": "Success",
      "StartTrigger": "StartWithPrevious",
      "RequiresPackagesToBeAcquired": false,
      "Actions": [
        {
          "Id": "a294520f-b12e-4790-9ad8-f87c7448b628",
          "Name": "Enable TeamCity NSG Rule",
          "ActionType": "Octopus.AzurePowerShell",
          "IsDisabled": false,
          "Environments": [],
          "Channels": [],
          "TenantTags": [],
          "Properties": {
            "Octopus.Action.Azure.AccountId": "azureserviceprincipal-microsoft-azure-service-principal",
            "Octopus.Action.Script.ScriptSource": "Inline",
            "Octopus.Action.Script.ScriptBody": "$nsg = Get-AzureRmNetworkSecurityGroup -Name $TeamCityNSGName -ResourceGroupName $InfraRg\n\n$rdpRule = $nsg | % SecurityRules | ? { $_.Name -eq 'RDP' -and $_.Priority -eq 999 }\n$rdpRule.Access = 'Allow'\n\n$nsg | Set-AzureRmNetworkSecurityGroup\n"
          }
        }
      ],
      "Properties": {
        "Octopus.Action.TargetRoles": "TeamCity Server (Windows)"
      }
    },
    {
      "Id": "5ebf899b-5e7a-4878-a19f-f1504707d4c8",
      "Name": "Get Octopus RDP Details",
      "Condition": "Success",
      "StartTrigger": "StartAfterPrevious",
      "RequiresPackagesToBeAcquired": false,
      "Actions": [
        {
          "Id": "b7931f09-6166-4d5d-98f9-4fdf3bd693ee",
          "Name": "Get Octopus RDP Details",
          "ActionType": "Octopus.AzurePowerShell",
          "IsDisabled": false,
          "Environments": [],
          "Channels": [],
          "TenantTags": [],
          "Properties": {
            "Octopus.Action.Azure.AccountId": "azureserviceprincipal-microsoft-azure-service-principal",
            "Octopus.Action.Script.ScriptSource": "Inline",
            "Octopus.Action.Script.ScriptBody": "$ip = (Get-AzureRmPublicIpAddress -Name OctopusPublicIP -ResourceGroupName $OctopusRg).IpAddress\n\"IP: $ip\"\n\"Password: $StackAdminPassword\"\n\"Username: $StackAdminUsername\""
          }
        }
      ],
      "Properties": {
        "Octopus.Action.TargetRoles": "Octopus Deploy Server"
      }
    },
    {
      "Id": "1d47a5fa-fa51-4d81-98ff-b380b3f3348a",
      "Name": "Get TeamCity RDP Details",
      "Condition": "Success",
      "StartTrigger": "StartWithPrevious",
      "RequiresPackagesToBeAcquired": false,
      "Actions": [
        {
          "Id": "b82a6e2b-0174-427f-8842-b7c3fe243f6d",
          "Name": "Get TeamCity RDP Details",
          "ActionType": "Octopus.AzurePowerShell",
          "IsDisabled": false,
          "Environments": [],
          "Channels": [],
          "TenantTags": [],
          "Properties": {
            "Octopus.Action.Azure.AccountId": "azureserviceprincipal-microsoft-azure-service-principal",
            "Octopus.Action.Script.ScriptSource": "Inline",
            "Octopus.Action.Script.ScriptBody": "$ip = (Get-AzureRmPublicIpAddress -Name TeamCityPublicIP -ResourceGroupName $TeamCityRg).IpAddress\n\"IP: $ip\""
          }
        }
      ],
      "Properties": {
        "Octopus.Action.TargetRoles": "TeamCity Server (Windows)"
      }
    }
  ],
  "RelatedDocumentIds": []
}